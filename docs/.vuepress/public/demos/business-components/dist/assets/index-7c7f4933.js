var ee=Object.defineProperty;var te=(p,r,o)=>r in p?ee(p,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):p[r]=o;var Q=(p,r,o)=>(te(p,typeof r!="symbol"?r+"":r,o),o);import{_ as oe,R as ne}from"./index-fad74159.js";import{_ as ae,C as se,y as re,v as ie,x as W,D as ce,k as P,L as le,r as l,o as x,d as T,h as d,t as U,G as g,b as i,w as c,f as B,c as L,g as A,F as de,e as ue,u as j,p as pe,j as me,a as fe,M as he,N as ge,O as Fe}from"./index-38f073c3.js";/*!
 * md5-es
 * https://github.com/logotype/es-crypto.git
 *
 * Copyright 2017 Victor Norgren
 * Released under the MIT license
 */const s=class{static hash(r){return s.hex(s.md51(r))}static md5cycle(r,o){let t=r[0],n=r[1],a=r[2],e=r[3];t=s.ff(t,n,a,e,o[0],7,-680876936),e=s.ff(e,t,n,a,o[1],12,-389564586),a=s.ff(a,e,t,n,o[2],17,606105819),n=s.ff(n,a,e,t,o[3],22,-1044525330),t=s.ff(t,n,a,e,o[4],7,-176418897),e=s.ff(e,t,n,a,o[5],12,1200080426),a=s.ff(a,e,t,n,o[6],17,-1473231341),n=s.ff(n,a,e,t,o[7],22,-45705983),t=s.ff(t,n,a,e,o[8],7,1770035416),e=s.ff(e,t,n,a,o[9],12,-1958414417),a=s.ff(a,e,t,n,o[10],17,-42063),n=s.ff(n,a,e,t,o[11],22,-1990404162),t=s.ff(t,n,a,e,o[12],7,1804603682),e=s.ff(e,t,n,a,o[13],12,-40341101),a=s.ff(a,e,t,n,o[14],17,-1502002290),n=s.ff(n,a,e,t,o[15],22,1236535329),t=s.gg(t,n,a,e,o[1],5,-165796510),e=s.gg(e,t,n,a,o[6],9,-1069501632),a=s.gg(a,e,t,n,o[11],14,643717713),n=s.gg(n,a,e,t,o[0],20,-373897302),t=s.gg(t,n,a,e,o[5],5,-701558691),e=s.gg(e,t,n,a,o[10],9,38016083),a=s.gg(a,e,t,n,o[15],14,-660478335),n=s.gg(n,a,e,t,o[4],20,-405537848),t=s.gg(t,n,a,e,o[9],5,568446438),e=s.gg(e,t,n,a,o[14],9,-1019803690),a=s.gg(a,e,t,n,o[3],14,-187363961),n=s.gg(n,a,e,t,o[8],20,1163531501),t=s.gg(t,n,a,e,o[13],5,-1444681467),e=s.gg(e,t,n,a,o[2],9,-51403784),a=s.gg(a,e,t,n,o[7],14,1735328473),n=s.gg(n,a,e,t,o[12],20,-1926607734),t=s.hh(t,n,a,e,o[5],4,-378558),e=s.hh(e,t,n,a,o[8],11,-2022574463),a=s.hh(a,e,t,n,o[11],16,1839030562),n=s.hh(n,a,e,t,o[14],23,-35309556),t=s.hh(t,n,a,e,o[1],4,-1530992060),e=s.hh(e,t,n,a,o[4],11,1272893353),a=s.hh(a,e,t,n,o[7],16,-155497632),n=s.hh(n,a,e,t,o[10],23,-1094730640),t=s.hh(t,n,a,e,o[13],4,681279174),e=s.hh(e,t,n,a,o[0],11,-358537222),a=s.hh(a,e,t,n,o[3],16,-722521979),n=s.hh(n,a,e,t,o[6],23,76029189),t=s.hh(t,n,a,e,o[9],4,-640364487),e=s.hh(e,t,n,a,o[12],11,-421815835),a=s.hh(a,e,t,n,o[15],16,530742520),n=s.hh(n,a,e,t,o[2],23,-995338651),t=s.ii(t,n,a,e,o[0],6,-198630844),e=s.ii(e,t,n,a,o[7],10,1126891415),a=s.ii(a,e,t,n,o[14],15,-1416354905),n=s.ii(n,a,e,t,o[5],21,-57434055),t=s.ii(t,n,a,e,o[12],6,1700485571),e=s.ii(e,t,n,a,o[3],10,-1894986606),a=s.ii(a,e,t,n,o[10],15,-1051523),n=s.ii(n,a,e,t,o[1],21,-2054922799),t=s.ii(t,n,a,e,o[8],6,1873313359),e=s.ii(e,t,n,a,o[15],10,-30611744),a=s.ii(a,e,t,n,o[6],15,-1560198380),n=s.ii(n,a,e,t,o[13],21,1309151649),t=s.ii(t,n,a,e,o[4],6,-145523070),e=s.ii(e,t,n,a,o[11],10,-1120210379),a=s.ii(a,e,t,n,o[2],15,718787259),n=s.ii(n,a,e,t,o[9],21,-343485551),r[0]=t+r[0]&4294967295,r[1]=n+r[1]&4294967295,r[2]=a+r[2]&4294967295,r[3]=e+r[3]&4294967295}static cmn(r,o,t,n,a,e){return o=(o+r&4294967295)+(n+e&4294967295)&4294967295,(o<<a|o>>>32-a)+t&4294967295}static ff(r,o,t,n,a,e,m){return s.cmn(o&t|~o&n,r,o,a,e,m)}static gg(r,o,t,n,a,e,m){return s.cmn(o&n|t&~n,r,o,a,e,m)}static hh(r,o,t,n,a,e,m){return s.cmn(o^t^n,r,o,a,e,m)}static ii(r,o,t,n,a,e,m){return s.cmn(t^(o|~n),r,o,a,e,m)}static md51(r){const o=r.length,t=[1732584193,-271733879,-1732584194,271733878],n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let a=0,e=64;for(e;e<=o;e+=64)s.md5cycle(t,s.md5blk(r.substring(e-64,e)));for(r=r.substring(e-64),e=0,a=r.length,e;e<a;e++)n[e>>2]|=r.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(s.md5cycle(t,n),e=0;e<16;e++)n[e]=0;return n[14]=o*8,s.md5cycle(t,n),t}static md5blk(r){const o=[];let t=0;for(t;t<64;t+=4)o[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24);return o}static rhex(r){let o="";return o+=s.hexArray[r>>4&15]+s.hexArray[r>>0&15],o+=s.hexArray[r>>12&15]+s.hexArray[r>>8&15],o+=s.hexArray[r>>20&15]+s.hexArray[r>>16&15],o+=s.hexArray[r>>28&15]+s.hexArray[r>>24&15],o}static hex(r){const o=r.length;let t=0;for(t;t<o;t++)r[t]=s.rhex(r[t]);return r.join("")}};let E=s;Q(E,"hexArray",["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"]);const V=p=>(pe("data-v-a99c9b32"),p=p(),me(),p),_e={class:"castle-login-wrap-bg"},xe={class:"ant-layout-header ant-pro-fixed-header login-header"},ye={class:"ant-pro-global-header ant-pro-global-header-layout-mix"},ve={class:"ant-pro-global-header-logo"},be=V(()=>d("img",{src:oe},null,-1)),Ce={class:"header-title"},we={class:"login-wrap"},Ae={class:"login-form-wrap"},Ee={class:"header-title"},Ve=V(()=>d("span",{class:"login-tip"},"登录到",-1)),Se=V(()=>d("br",null,null,-1)),Ie=V(()=>d("br",null,null,-1)),Ne=["src"];const Re={class:"copyright"},Oe={__name:"index",setup(p){var q,z;const r=["development"].includes("production"),o=r,t=se("encrypt"),n=re(),a=ie(),e=W(()=>a.title),m=W(()=>a.copyright),_=ce({username:"",password:"",verificationCode:"",remember:!1});let S=P(!1);const Y=async f=>{var C,w;S.value=!0;const u=fe(),{redirect:R,...b}=n.currentRoute.value.query,F=(w=(C=j)==null?void 0:C.userApiImplement)==null?void 0:w.rsaPublicKey;let y;F?y=await F():o&&console.warn("[Castle] 未配置 RSA 公钥，请在 settings.js 里面添加 userApiImplement -> rsaPublicKey 项"),u.login({...f,encryptUserName:E.hash(f.username),encryptPassword:t(f.password,y),encryptVerificationCodeAndPassWord:t(`${f.verificationCode}${f.password}`,y)}).then(()=>{n.push({name:R||"index",query:{...b}})}).finally(()=>{S.value=!1})},I=P(null),v=P(!1),N=(z=(q=j)==null?void 0:q.userApiImplement)==null?void 0:z.getVerificationCode,$=async()=>{v.value=!0,N&&(I.value=await N(),v.value=!1)};le(()=>{$()});const H=()=>{const f={}.VITE_DEVELOPER_USER_NAME,u={}.VITE_PROJECT_NAME;if(!(f&&u)){he.confirm({title:"提示",icon:i(ge),content:"你未在 env.local 配置 VITE_DEVELOPER_USER_NAME 和 VITE_PROJECT_NAME 字段，该功能无法使用",okText:"确认",cancelText:"取消"});return}Fe("Castle Platform"),window.open(`http://castle-platform.cp.hxdi.cn/auto-login?developer=${f}&project=${u}&redirect=${window.location.origin}`)};return(f,u)=>{const R=l("UserOutlined"),b=l("a-input"),F=l("a-form-item"),y=l("LockOutlined"),C=l("a-input-password"),w=l("SyncOutlined"),X=l("a-tooltip"),O=l("a-col"),Z=l("a-spin"),M=l("a-row"),Pe=l("a-checkbox"),K=l("a-button"),D=l("ABadgeRibbon"),k=l("a-form");return x(),T("div",_e,[d("header",xe,[d("div",ye,[d("div",ve,[d("a",null,[be,d("h1",Ce,U(g(e)),1)])])])]),d("div",we,[i(M,{gutter:[16,16]},{default:c(()=>[i(O,{xs:24,sm:12,md:8,lg:6,xl:6,xxl:6,xxxl:4},{default:c(()=>{var J,G;return[d("div",Ae,[d("h1",Ee,[Ve,Se,B(U(g(e)),1)]),Ie,i(k,{model:_,name:"normal_login",class:"login-form",onFinish:Y},{default:c(()=>[i(F,{name:"username",rules:[{required:!0,message:"请输入用户名"}]},{default:c(()=>[i(b,{placeholder:"用户名",size:"large",value:_.username,"onUpdate:value":u[0]||(u[0]=h=>_.username=h)},{prefix:c(()=>[i(R,{class:"site-form-item-icon"})]),_:1},8,["value"])]),_:1}),i(F,{name:"password",rules:[{required:!0,message:"请输入密码"}]},{default:c(()=>[i(C,{placeholder:"密码",size:"large",autoComplete:"on",value:_.password,"onUpdate:value":u[1]||(u[1]=h=>_.password=h)},{prefix:c(()=>[i(y,{class:"site-form-item-icon"})]),_:1},8,["value"])]),_:1}),g(N)?(x(),L(M,{key:0,gutter:[16,16],justify:"space-between",align:"middle"},{default:c(()=>[i(O,{span:14},{default:c(()=>[i(F,{name:"verificationCode",rules:[{required:!0,message:"请输入验证码"}]},{default:c(()=>[i(b,{placeholder:"验证码",size:"large",value:_.verificationCode,"onUpdate:value":u[2]||(u[2]=h=>_.verificationCode=h)},{suffix:c(()=>[i(X,{title:"点击刷新图形验证码"},{default:c(()=>[i(w,{class:"site-form-item-icon",style:{cursor:"pointer"},onClick:$,spin:v.value},null,8,["spin"])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),i(O,{span:10},{default:c(()=>[i(Z,{spinning:v.value},{default:c(()=>[i(F,null,{default:c(()=>[I.value?(x(),T("img",{key:0,style:{height:"40px",float:"right"},src:I.value,alt:"code"},null,8,Ne)):A("",!0)]),_:1})]),_:1},8,["spinning"])]),_:1})]),_:1})):A("",!0),A("",!0),i(F,null,{default:c(()=>[i(K,{size:"large",block:"",type:"primary","html-type":"submit",class:"login-form-button",loading:g(S)},{default:c(()=>[B(" 登录 ")]),_:1},8,["loading"]),g(r)?(x(),L(D,{key:0,text:"仅在开发模式下显示",color:"volcano"},{default:c(()=>[i(K,{size:"large",block:"",style:{"margin-top":"20px"},onClick:H},{default:c(()=>[B(" 🧭 跳转到中台登陆 ")]),_:1})]),_:1})):A("",!0)]),_:1})]),_:1},8,["model"]),(x(!0),T(de,null,ue((G=(J=g(j))==null?void 0:J.userApiImplement)==null?void 0:G.customComponents,h=>(x(),L(g(ne),{key:h,componentVnode:h},null,8,["componentVnode"]))),128))])]}),_:1})]),_:1})]),d("footer",Re,U(typeof g(m)=="function"&&g(m)()),1)])}}},Le=ae(Oe,[["__scopeId","data-v-a99c9b32"]]);export{Le as default};
