import{R as Z,_ as ee}from"./index-fad74159.js";import{u as k,m as te,M as ae,_ as N,a as G,r as n,o as u,c as P,w as r,b as t,d as m,F as $,e as J,f as x,t as S,g as z,h as A,i as se,p as Q,j as W,k as X,l as ne,n as oe,q as Y,s as ce,v as le,x as R,y as re,z as ue,A as ie,B as de,C as he,D as q,E as pe,G as y,H as _e}from"./index-38f073c3.js";import fe from"./page-layout-5334905a.js";const me={name:"AvatarDropdown",props:{currentUser:{type:Object,default:()=>null},menu:{type:Boolean,default:!0}},computed:{userNavigation(){var e;return(e=k)==null?void 0:e.userNavigation}},methods:{...te(G,["logout"]),handleLogout(){ae.confirm({title:"提示",content:"你确认登出吗？",onOk:()=>{this.logout().then(()=>{this.$router.push({name:"login"})})},onCancel(){},okText:"确认登出",cancelText:"取消"})}}},ve={class:"account-avatar"},ye={class:"account-name"};function ge(e,a,o,c,C,_){const v=n("UserOutlined"),I=n("a-avatar"),O=n("DownOutlined"),L=n("a-menu-item"),K=n("a-menu-divider"),B=n("a-menu"),h=n("a-dropdown");return u(),P(h,{placement:"bottomRight"},{overlay:r(()=>[t(B,{class:"drop-down menu","selected-keys":[]},{default:r(()=>{var T;return[Array.isArray(_.userNavigation)&&_.userNavigation.length>0?(u(),m($,{key:0},[(u(!0),m($,null,J(_.userNavigation,f=>(u(),m($,{key:f.label},[f!=null&&f.displayFn&&f.displayFn()!==!1?(u(),P(L,{key:0,onClick:U=>f.handleFn(e.$router)},{default:r(()=>[x(S(f.label),1)]),_:2},1032,["onClick"])):z("",!0)],64))),128)),t(K)],64)):z("",!0),(T=o.currentUser)!=null&&T.name?(u(),P(L,{key:"logout",onClick:_.handleLogout},{default:r(()=>[x(" 退出 ")]),_:1},8,["onClick"])):z("",!0)]}),_:1})]),default:r(()=>[A("span",ve,[t(I,{size:28,style:{"background-color":"#3a5a78"}},{icon:r(()=>[t(v)]),_:1}),A("span",ye,S(o.currentUser.name||"未登录"),1),t(O)])]),_:1})}const be=N(me,[["render",ge],["__scopeId","data-v-99994d28"]]);const ke={props:{mode:{type:String,default:"light"}}},xe=e=>(Q("data-v-30ff82a9"),e=e(),W(),e),Pe={role:"img","aria-label":"close",class:"anticon"},we={key:0,xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",viewBox:"0 0 24 24",class:"sun","data-v-3f00b36e":""},Ce=se('<path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z" data-v-30ff82a9></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z" data-v-30ff82a9></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z" data-v-30ff82a9></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z" data-v-30ff82a9></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z" data-v-30ff82a9></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z" data-v-30ff82a9></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z" data-v-30ff82a9></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z" data-v-30ff82a9></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z" data-v-30ff82a9></path>',9),Le=[Ce],Me={key:1,xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",viewBox:"0 0 24 24",class:"moon","data-v-3f00b36e":""},$e=xe(()=>A("path",{d:"M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"},null,-1)),Se=[$e];function Ae(e,a,o,c,C,_){return u(),m("span",Pe,[o.mode==="light"?(u(),m("svg",we,Le)):(u(),m("svg",Me,Se))])}const H=N(ke,[["render",Ae],["__scopeId","data-v-30ff82a9"]]),Ke={__name:"index",setup(e){const a=X(localStorage.getItem("CASTLE__darknessMode")!=="dark");return ne(a,o=>oe.emit("CASTLE__changeDarknessMode",o)),(o,c)=>{const C=n("a-switch");return u(),P(C,{checked:a.value,"onUpdate:checked":c[0]||(c[0]=_=>a.value=_)},{checkedChildren:r(()=>[t(H,{mode:"light"})]),unCheckedChildren:r(()=>[t(H,{mode:"dark"})]),_:1},8,["checked"])}}};function Te(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ce(e)}const Ee={name:"MultiTab",data(){return{fullPathList:[],pages:[],activeKey:"",newTabIndex:0}},created(){this.pages.push(this.$route),this.fullPathList.push(this.$route.fullPath),this.selectedLastPath()},methods:{onEdit(e,a){this[a](e)},remove(e){this.pages=this.pages.filter(a=>a.fullPath!==e),this.fullPathList=this.fullPathList.filter(a=>a!==e),this.fullPathList.includes(this.activeKey)||this.selectedLastPath()},selectedLastPath(){this.activeKey=this.fullPathList[this.fullPathList.length-1]},closeThat(e){this.fullPathList.length>1?this.remove(e):this.$message.info("这是最后一个标签了, 无法被关闭")},closeLeft(e){const a=this.fullPathList.indexOf(e);a>0?this.fullPathList.forEach((o,c)=>{c<a&&this.remove(o)}):this.$message.info("左侧没有标签")},closeRight(e){const a=this.fullPathList.indexOf(e);a<this.fullPathList.length-1?this.fullPathList.forEach((o,c)=>{c>a&&this.remove(o)}):this.$message.info("右侧没有标签")},closeAll(e){const a=this.fullPathList.indexOf(e);this.fullPathList.forEach((o,c)=>{c!==a&&this.remove(o)})},closeMenuClick(e,a){this[e](a)},renderTabPaneMenu(e){return t(n("a-menu"),{onClick:({key:a,item:o,domEvent:c})=>{this.closeMenuClick(a,e)}},{default:()=>[t(n("a-menu-item"),{key:"closeThat"},{default:()=>[t(n("close-outlined"),null,null),x("  关闭当前标签")]}),t(n("a-menu-item"),{key:"closeRight"},{default:()=>[t(n("arrow-right-outlined"),null,null),x("  关闭右侧")]}),t(n("a-menu-item"),{key:"closeLeft"},{default:()=>[t(n("arrow-left-outlined"),null,null),x("  关闭左侧")]}),t(n("a-menu-item"),{key:"closeAll"},{default:()=>[t(n("delete-outlined"),null,null),x("  关闭全部")]})]})},renderTabPane(e,a){const o=this.renderTabPaneMenu(a);return t(n("a-dropdown"),{overlay:o,trigger:["contextmenu"]},{default:()=>[t("span",{style:{userSelect:"none"}},[e])]})}},watch:{$route:function(e){this.activeKey=e.fullPath,this.fullPathList.indexOf(e.fullPath)<0&&(this.fullPathList.push(e.fullPath),this.pages.push(e))},activeKey:function(e){this.$router.push(e)}},render(){const{onEdit:e,$data:{pages:a}}=this,o=a.map(c=>t(n("a-tab-pane"),{style:{height:0},tab:this.renderTabPane(c.meta.customTitle||c.meta.title,c.fullPath),key:c.fullPath,closable:a.length>1},null));return t("div",{class:"ant-pro-multi-tab"},[t("div",{class:"ant-pro-multi-tab-wrapper"},[t(n("a-tabs"),Y({hideAdd:!0,type:"editable-card",activeKey:this.activeKey,"onUpdate:activeKey":c=>this.activeKey=c,tabBarStyle:{marginBottom:"-1px"}},{onEdit:e}),Te(o)?o:{default:()=>[o]})])])}};const De=N(Ee,[["__scopeId","data-v-37ab3808"]]);const Re=e=>(Q("data-v-6d785634"),e=e(),W(),e),ze=Re(()=>A("img",{src:ee},null,-1)),Ne={class:"logo-title"},Ie={key:0},Oe={__name:"basic-layout",setup(e){var U;const a=le(),o=G(),c=R(()=>a.title),C=R(()=>o.name),_=R(()=>o.role),v=re(),{menuData:I}=ue(ie(v.getRoutes())),O=de(),L=i=>{const p=i.sort((s,l)=>{var w,g,b,E;return typeof((w=s==null?void 0:s.meta)==null?void 0:w.sort)=="number"&&typeof((g=l==null?void 0:l.meta)==null?void 0:g.sort)=="number"?((b=s==null?void 0:s.meta)==null?void 0:b.sort)-((E=l==null?void 0:l.meta)==null?void 0:E.sort):0}).filter(s=>{var g,b;const l=((g=s==null?void 0:s.meta)==null?void 0:g.requiresAuth)??!0,w=((b=s==null?void 0:s.meta)==null?void 0:b.permissions)??[];return l?O.checkPermission(w):!0});return p.forEach(s=>{s!=null&&s.children&&(s.children=L(s==null?void 0:s.children))}),p},K=X(!1);he("bus").on("castle-global-loading",i=>K.value=i);const h=q({collapsed:!1,openKeys:[],selectedKeys:[],showMenu:!0,currentUser:{name:C,role:_}}),T=q({headerTheme:"dark",layout:"mix",splitMenus:!1,menuData:L(I),...(U=k)==null?void 0:U.layout});pe(()=>{var i,p;if(v.currentRoute){const s=v.currentRoute.value.matched.concat();h.selectedKeys=[...s.filter(l=>l.name!=="index").map(l=>l.path),(p=(i=v.currentRoute.value)==null?void 0:i.meta)==null?void 0:p.activeMenuPath],h.openKeys=s.filter(l=>l.path!==v.currentRoute.value.path).map(l=>l.path)}});const f=R(()=>v.currentRoute.value.matched.concat().map(i=>({path:i.path,breadcrumbName:i.meta.title||""})));return(i,p)=>{var F,j;const s=n("RouterLink"),l=n("a-divider"),w=n("a-space"),g=n("a-spin"),b=n("PageContainer"),E=n("pro-layout");return u(),P(E,Y(T,{openKeys:h.openKeys,"onUpdate:openKeys":p[0]||(p[0]=d=>h.openKeys=d),collapsed:h.collapsed,"onUpdate:collapsed":p[1]||(p[1]=d=>h.collapsed=d),selectedKeys:h.selectedKeys,"onUpdate:selectedKeys":p[2]||(p[2]=d=>h.selectedKeys=d),breadcrumb:{routes:((j=(F=y(k))==null?void 0:F.breadcrumb)==null?void 0:j.display)===!0?y(f):null}}),{menuHeaderRender:r(()=>[t(s,{to:"/"},{default:r(()=>[ze,A("h1",Ne,S(y(c)),1)]),_:1})]),breadcrumbRender:r(({route:d,params:D,routes:M})=>[M.indexOf(d)===M.length-1?(u(),m("span",Ie,S(d.breadcrumbName),1)):(u(),P(s,{key:1,to:{path:d.path,params:D}},{default:r(()=>[x(S(d.breadcrumbName),1)]),_:2},1032,["to"]))]),rightContentRender:r(()=>[t(w,{size:10},{default:r(()=>{var d,D,M;return[(u(!0),m($,null,J((d=y(k))==null?void 0:d.userNavigationComponents,V=>(u(),P(y(Z),{key:V,componentVnode:V},null,8,["componentVnode"]))),128)),(M=(D=y(k))==null?void 0:D.darkness)!=null&&M.showSwitch?(u(),m($,{key:0},[t(l,{type:"vertical",style:{"background-color":"#6f8edd"}}),t(Ke)],64)):z("",!0),t(be,{menu:h.showMenu,"current-user":h.currentUser},null,8,["menu","current-user"])]}),_:1})]),default:r(()=>[t(b,{title:i.$route.meta.showPageTitle!==!1&&!y(k).multiTab&&i.$route.meta.title,"sub-title":i.$route.meta.subTitle},_e({default:r(()=>[t(g,{spinning:K.value},{default:r(()=>[t(fe)]),_:1},8,["spinning"])]),_:2},[y(k).multiTab?{name:"content",fn:r(()=>[t(De)]),key:"0"}:void 0]),1032,["title","sub-title"])]),_:1},16,["openKeys","collapsed","selectedKeys","breadcrumb"])}}},je=N(Oe,[["__scopeId","data-v-6d785634"]]);export{je as default};
